<% layout('/layouts/boilerplate') %>
<h1>Articles</h1>
<hr>
    <% for(let i = 0; i < data.length; i++){ %>
        <section class="card shadow p-3 mb-3 bg-body rounded">
            <h2>
                <a href="/articles/<%= data[i]._id %>" class="title">
                    <%= data[i].title %>
                </a>
            </h2>
            <hr>
            <article class="description m-3">
                <%- data[i].description %>
                 <a href="/articles/<%= data[i]._id %>">[Read More...]</a>
            </article>
            <hr>
            <div class="description text-muted container cardFooter">
                <div class="row">
                    <div class="col-sm">Modified at <%= data[i].modifiedAt.toDateString() %></div>
                    <div class="col-sm">Created at <%= data[i].createdAt.toDateString() %></div>
                    <% if (data[i].readMinutes > 1) { %>
                        <div class="col-sm"> <%= data[i].readMinutes %> minutes read</div>
                    <% } else { %>
                        <div class="col-sm"> <%= data[i].readMinutes %> minute read</div>
                    <% } %>
                </div>
                <hr>
                <div class="row">
                    <div class="col-sm"><button id="like">Like</button></div>
                    <div class="col-sm"><button id="dislike">Dislike</button></div>
                    <div class="col-sm"><button class = '<%= data[i]._id %>' id="save<%= i %>">Save</button></div>
                </div>
            </div>
        </section>
    <% } %>

    <section class="pagination d-flex flex-row flex-wrap justify-content-center card shadow p-2 mb-3 bg-body rounded">
        <% if((currentPage - 1) >= 1) { %>
            <div class="px-3 py-3">
                <a href="/articles?page=<%= currentPage - 1 %>"> Previous </a>
            </div>
        <% } else { %>
            <div class="px-3 py-3">
                <a href="#"> Previous </a>
            </div>
        <% } %> 
        <% for(let i = temp; i < temp + 3; i++){ %>
            <% if(i <= totalPages) { %>
            <div class="px-5 py-3"> 
                <a href="/articles?page=<%= i %>"><%= i %></a> 
            </div>
            <% } else {%>
                <% break; %>
                <% } %>
        <% } %>    
        <% if(totalPages > 3) { %>
            <div class="px-5 py-3"> 
                <a href="#">...</a> 
            </div>
            <div class="px-5 py-3"> 
                <a href="/articles?page=<%= totalPages %>"><%= totalPages %></a> 
            </div>
        <% } %>
        <% if((currentPage + 1) <= totalPages) { %>
            <div class="px-3 py-3">
                <a href="/articles?page=<%= currentPage + 1 %>"> Next </a>
            </div>
        <% } else { %>
            <div class="px-3 py-3">
                <a href="#"> Next </a>
            </div>
        <% } %>    
    </section>
    
    <script>
        const save0 = document.querySelector('#save0');
        const save1 = document.querySelector('#save1');
        const save2 = document.querySelector('#save2');
        const save3 = document.querySelector('#save3');
        save0.addEventListener('click', (e) => {
            e.preventDefault();
            try {
                const res = fetch('/user/save', {
                    method: 'POST',
                    body: JSON.stringify({
                        articleId: save0.classList[0]
                    }),
                    headers: { 'Content-Type': 'application/json' }
                });
            } catch (err) {
                console.log(err);
            }      
        });
        save1.addEventListener('click', (e) => {
            e.preventDefault();
            try {
                const res = fetch('/user/save', {
                    method: 'POST',
                    body: JSON.stringify({
                        articleId: save1.classList[0]
                    }),
                    headers: { 'Content-Type': 'application/json' }
                });
            } catch (err) {
                console.log(err);
            }      
        });
        save2.addEventListener('click', (e) => {
            e.preventDefault();
            try {
                const res = fetch('/user/save', {
                    method: 'POST',
                    body: JSON.stringify({
                        articleId: save2.classList[0]
                    }),
                    headers: { 'Content-Type': 'application/json' }
                });
            } catch (err) {
                console.log(err);
            }      
        });
        save3.addEventListener('click', (e) => {
            e.preventDefault();
            try {
                const res = fetch('/user/save', {
                    method: 'POST',
                    body: JSON.stringify({
                        articleId: save3.classList[0]
                    }),
                    headers: { 'Content-Type': 'application/json' }
                });
            } catch (err) {
                console.log(err);
            }      
        });
    </script>